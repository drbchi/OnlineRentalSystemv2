<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Suite Room page</title>

    <!-- Fonts and Icons (same as index.html) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <!-- Use visitor-sec.css as the primary stylesheet -->
    <link rel="stylesheet" href="suiteroom.css">
</head>

<body>
    <!-- Header Section (same as index.html) -->
    <header>
        <div class="header-top">
            <div class="logo-container">
                <img src="../images/logo.png" alt="Casalux Logo" class="logo-img">
                <div class="logo">Casalux</div>
            </div>
            <div class="auth-buttons">

                <button class="register"><a href="../loginANDsignup/sign-up.html" style="text-decoration: none; color: inherit;">Register</a></button>
                <button class="signin"><a href="../loginANDsignup/log-in.html" style="text-decoration: none; color: inherit;">Sign in</a></button>
            </div>
        </div>

        <!-- Navigation Menu (below the logo) -->
        <nav>
            <ul>
                <li class="home"><a href="../visitors/visitors.html">Home</a></li>
                <li class="stays"><a href="../staysSection/stays.html">Stays</a></li>
                <li class="listyourproperty"><a href="../PropertyManagement/prop.html">List your rooms</a></li>
                <li class="aboutus"><a href="../aboutusSection/about-us.html">About Us</a></li>
            </ul>
        </nav>
    </header>


    <!-- Property Grid -->
    <div class="property-grid" id="property-grid">
        <!-- Properties will be dynamically added here -->
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination">
        <!-- Pagination buttons will be dynamically added here -->
    </div>


    <!-- Featured Rooms Section -->
    <div class="featured-rooms-section">
        <h2>Suite Rooms</h2>

        <div id="featured-rooms-grid" class="featured-rooms-grid">

            </div>
    </div>
    </div>z

    <footer>
        <p>&copy; 2025 Online Rental Website. All rights reserved.</p>
        <div class="footer-links">
            <a href="../profile/privacy-policy.html">Privacy Policy</a>
            <a href="../profile/terms-and-conditions.html">Terms of Service</a>
            <a href="../HelpSection/help.html">Help & Support</a>
        </div>
    </footer>




        <!-- Profile Popup Modal -->
<div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
      <span class="close-profile-modal">&times;</span>
      <iframe src="../profile/profile.html" frameborder="0"></iframe>
    </div>
  </div>

    <!-- <script src=".js"></script> -->
</body>


<script>
    fetch('../apis/visitor.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                "action": "getrooms",
                "roomtype": "suite"
            })
        })
        .then(response => response.json()) 
        .then(data => {
            if (data.status === 200) {
                displayRooms(data.data); 
            } else {
                console.error("Error:", data.message);
                const container = document.getElementById('featured-rooms-grid');
                container.innerHTML = `<p>${data.message}</p>`;
            }
        })
        .catch(error => console.error("Fetch error:", error));

// function displayRooms(rooms) {
//     const container = document.getElementById('featured-rooms-grid');
//     container.innerHTML = "";

//     rooms.forEach(room => {
//         const roomDiv = document.createElement('div');
//         roomDiv.classList.add('featured-room');

//         roomDiv.innerHTML = `
//             <div class="room-box">
//                 <img src="${room.images}" alt="Room ${room.id}">
//                 <h3>Room ${room.id} - ${room.title}</h3>
//             </div>
//             <div class="room-details">
//                 <p><strong>Description:</strong> ${room.description}</p>
//                 <p><strong>Price:</strong> $${room.price}/night</p>
//                 <p><strong>Room Type:</strong> ${room.roomtype}</p>
//                 <p><strong>Capacity:</strong> ${room.capacity}</p>
//                 <p><strong>Location:</strong> ${room.location}</p>
//                 <a href="../bookingPage/booking.html?roomTitle=${encodeURIComponent(room.title)}">
//                     <button class="book-now">Book Now</button>
//                 </a>
//             </div>
//         `;

//         container.appendChild(roomDiv);
//     });
// }





async function getApprovedRoomTitles() {
    try {
        // const response = await fetch("../ownerapp/get_bookings.php");
        const response = await fetch("../ownerapp/get_bookings.php?status=approved");

        const data = await response.json();

        // ✅ Only include approved bookings
        const approved = data.filter(booking => booking.status === 'approved');
        return approved.map(booking => booking.room_title);
    } catch (error) {
        console.error("Error fetching approved bookings:", error);
        return [];
    }
}







async function displayRooms(rooms) {
    const container = document.getElementById('featured-rooms-grid');
    container.innerHTML = "";

    const approvedRoomTitles = await getApprovedRoomTitles(); // fetch approved bookings

    rooms.forEach(room => {
        // const isBooked = approvedRoomTitles.includes(room.title);
        const titleOnly = room.title.replace(/^Room\s\d+\s[-–]\s/, '').trim(); // e.g., removes "Room 9 -"
const isBooked = approvedRoomTitles.includes(titleOnly);


        const roomDiv = document.createElement('div');
        roomDiv.classList.add('featured-room');

        roomDiv.innerHTML = `
            <div class="room-box">
                <img src="${room.images}" alt="Room ${room.id}">
                <h3>Room ${room.id} - ${room.title}</h3>
            </div>
            <div class="room-details">
                <p><strong>Description:</strong> ${room.description}</p>
                <p><strong>Price:</strong> $${room.price}/night</p>
                <p><strong>Room Type:</strong> ${room.roomtype}</p>
                <p><strong>Capacity:</strong> ${room.capacity}</p>
                <p><strong>Location:</strong> ${room.location}</p>
                ${
                    isBooked
                    ? `<button class="book-now" disabled>Booked</button>`
                    : `<a href="../bookingPage/booking.html?roomTitle=${encodeURIComponent(room.title)}"><button class="book-now">Book Now</button></a>`
                }
            </div>
        `;

        container.appendChild(roomDiv);
    });
}






















document.addEventListener("DOMContentLoaded", () => {
    const authButtons = document.querySelector(".auth-buttons");
    const userEmail = localStorage.getItem("userEmail");

    if (userEmail && authButtons) {

        authButtons.innerHTML = "";

        const firstLetter = userEmail.charAt(0).toUpperCase();

        const profileCircle = document.createElement("div");
        profileCircle.textContent = firstLetter;
        profileCircle.style.width = "35px";
        profileCircle.style.height = "35px";
        profileCircle.style.borderRadius = "50%";
        profileCircle.style.backgroundColor = "purple";
        profileCircle.style.color = "white";
        profileCircle.style.display = "flex";
        profileCircle.style.justifyContent = "center";
        profileCircle.style.alignItems = "center";
        profileCircle.style.fontWeight = "bold";
        profileCircle.style.fontSize = "16px";
        profileCircle.style.cursor = "pointer";
        profileCircle.title = "Click to log out";

        // profileCircle.addEventListener("click", () => {
        //     if (confirm("Do you want to log out?")) {
        //         localStorage.removeItem("userEmail");
        //         location.reload();
        //     }
        // });

         profileCircle.addEventListener("click", () => {
            const modal = document.getElementById("profileModal");
            if (modal) {
                modal.style.display = "block";
            }
        });




       
        










        authButtons.appendChild(profileCircle);
    }
});



document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("profileModal");
    const closeBtn = document.querySelector(".close-profile-modal");

    if (modal && closeBtn) {
        closeBtn.addEventListener("click", () => {
            modal.style.display = "none";
        });

        window.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.style.display = "none";
            }
        });
    }
});













 

</script>









<!-- <script>
    fetch('../apis/visitor.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            "action": "getrooms",
            "roomtype": "suite"
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 200) {
            displayRooms(data.data);
        } else {
            console.error("Error:", data.message);
            const container = document.getElementById('featured-rooms-grid');
            container.innerHTML = `<p>${data.message}</p>`;
        }
    })
    .catch(error => console.error("Fetch error:", error));

function getBookedRooms() {
    return JSON.parse(localStorage.getItem("bookedRooms") || "[]");
}

function displayRooms(rooms) {
    const container = document.getElementById('featured-rooms-grid');
    container.innerHTML = "";
    const bookedRooms = getBookedRooms();

    rooms.forEach(room => {
        const roomDiv = document.createElement('div');
        roomDiv.classList.add('featured-room');

        const isBooked = bookedRooms.includes(room.title);

        roomDiv.innerHTML = `
            <div class="room-box">
                <img src="${room.images}" alt="Room ${room.id}">
                <h3>Room ${room.id} - ${room.title}</h3>
            </div>
            <div class="room-details">
                <p><strong>Description:</strong> ${room.description}</p>
                <p><strong>Price:</strong> $${room.price}/night</p>
                <p><strong>Room Type:</strong> ${room.roomtype}</p>
                <p><strong>Capacity:</strong> ${room.capacity}</p>
                <p><strong>Location:</strong> ${room.location}</p>
                ${
                    isBooked
                    ? `<button class="book-now" disabled>Booked</button>`
                    : `<a href="../bookingPage/booking.html?roomTitle=${encodeURIComponent(room.title)}"><button class="book-now">Book Now</button></a>`
                }
            </div>
        `;

        container.appendChild(roomDiv);
    });
}

// ✅ User profile circle logic
document.addEventListener("DOMContentLoaded", () => {
    const authButtons = document.querySelector(".auth-buttons");
    const userEmail = localStorage.getItem("userEmail");

    if (userEmail && authButtons) {
        authButtons.innerHTML = "";
        const firstLetter = userEmail.charAt(0).toUpperCase();

        const profileCircle = document.createElement("div");
        profileCircle.textContent = firstLetter;
        profileCircle.style.width = "35px";
        profileCircle.style.height = "35px";
        profileCircle.style.borderRadius = "50%";
        profileCircle.style.backgroundColor = "purple";
        profileCircle.style.color = "white";
        profileCircle.style.display = "flex";
        profileCircle.style.justifyContent = "center";
        profileCircle.style.alignItems = "center";
        profileCircle.style.fontWeight = "bold";
        profileCircle.style.fontSize = "16px";
        profileCircle.style.cursor = "pointer";
        profileCircle.title = "Click to log out";

        profileCircle.addEventListener("click", () => {
            if (confirm("Do you want to log out?")) {
                localStorage.removeItem("userEmail");
                location.reload();
            }
        });

        authButtons.appendChild(profileCircle);
    }
});
</script> -->




















</html>